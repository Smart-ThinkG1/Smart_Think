<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>

    <!-- Icons Font Awesome -->
    <script src="https://kit.fontawesome.com/64ceb195cd.js" crossorigin="anonymous"></script>
    <!-- Icones Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- CSS do DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- CSS do Swipper Slides -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- JS do DataTables -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <!-- CSS Local -->
    <link rel="stylesheet" href="../css/dashboard.css">
</head>

<body>


    <div class="dash-box">

        <!-- sidebar -->
        <div class="sidebar">

            <!-- header sidebar -->
            <div class="header-sidebar">

                <!-- logo -->
                <div class="nav-logo">
                    <img src="../assets/logoBranca.svg" alt="">
                    <h2>Smart Think</h2>
                </div>

                <!-- botão que muda sidebar -->
                <div id="toggle-dash-btn">
                    <i class="fa-solid fa-bars"></i>
                </div>
            </div>
            <!-- fim header sidebar -->

            <!-- menu sidebar -->
            <nav class="menu">
                <div class="menu-label">
                    <h2>Menu</h2>
                </div>
                <ul class="nav-menu">

                    <!-- visão geral -->
                    <li class="nav-item " data-target="visaoGeral">
                        <a href="#visaoGeral">
                            <i class='bx bxs-grid-alt'></i>
                            <p>Visão Geral</p>
                        </a>
                    </li>

                    <!-- unidades -->
                    <li class="nav-item" data-target="unidades">
                        <a href="#unidades">
                            <i class='bx bxs-store'></i>
                            <p>Unidades</p>
                        </a>
                    </li>

                    <!-- campanhas  -->
                    <li class="nav-item">
                        <a href="">
                            <i class='bx bxs-calendar-event'></i>
                            <p>Campanhas</p>
                        </a>
                    </li>

                    <!-- notificações -->
                    <li class="nav-item">
                        <a href="">
                            <i class='bx bxs-inbox'></i>
                            <p>Notificações</p>
                        </a>
                    </li>

                    <!-- configurações -->
                    <li class="nav-item submenu">
                        <i class='bx bxs-cog'></i>
                        <p>Configurações</p>
                        <span>▾</span>
                    </li>
                    <ul class="submenu-list">
                        <li class="submenu-item">
                            <a href="">
                                <p>Meu perfil</p>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="">
                                <p>Minha marca</p>
                            </a>
                        </li>
                    </ul>

                </ul>
            </nav>
            <!-- fim menu sidebar -->

            <!-- footer sidebar -->
            <div class="footer-sidebar">
                <div class="menu-user">
                    <div class="user-icon"><i class="fa-solid fa-user"></i></div>
                    <div class="user-account">
                        <div class="userName"><span>Fernando Henrique</span></div>
                        <div class="userEmail"><span>fernando.321.www@gmail.com</span></div>
                    </div>
                    <div id="exitBtn"><i class="fa-solid fa-right-from-bracket"></i></div>
                </div>
            </div>
            <!-- fim footer sidebar -->
        </div>
        <!-- fim sidebar -->

        <!-- conteudo da dash -->
        <div class="dash-content">

            <!-- header da dash -->
            <div class="dash-header">

                <div class="title"><span>Visão Geral</span></div>
                <div id="modal-notify">
                    <i class='bx bxs-inbox'></i>
                </div>
            </div>
            <!-- fim header da dash -->

            <!-- corpo da dash -->
            <div class="dash-body" id="visaoGeral">
                <div class="kpi-wrapper">

                    <!-- kpi 1 -->
                    <div class="kpi-card primary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Unidades Ativas</h2>
                            </div>

                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Total de 5 unidades</p>
                                </div>
                            </div>

                        </div>
                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>5</span>
                            </div>
                        </div>
                    </div>

                    <!-- kpi 2 -->
                    <div class="kpi-card secondary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Nível de Satisfação Médio</h2>
                            </div>
                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Total de 4 unidades</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>20%</span>
                            </div>
                        </div>
                    </div>

                    <!-- kpi 3 -->
                    <div class="kpi-card secondary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Média de reclamações por filial</h2>
                            </div>

                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Esse valor representa uma estimativa mensal a partir da análise de sentimento dos
                                        clientes.</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>45</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-wrapper">
                    <!-- card 1 -->
                    <div class="chart-card">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Distribuição de reclamações</h2>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-box">
                                <canvas id="myChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- card 2 -->
                    <div class="chart-card swiper">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Comparativo de unidades</h2>
                            </div>
                            <!-- Pagination -->
                            <div class="swiper-pagination"></div>
                        </div>


                        <!-- Unidade 1 -->
                        <div class="swiper-wrapper">
                            <div class="card-body swiper-slide">
                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->
                                        
                                        <div class="unit-desc">
                                            <h3 class="name">Unidade Matriz</h3>
                                            <p class="adress">Av. Sapopemba, 20020 - Vila Ester, São Paulo - SP,
                                                08330-245</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">1.5</span>
                                            <span class="star-rating" data-rating-value="1.5"></span>
                                            <span class="review-number">(300 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->
                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart1"></canvas>
                                        </div>
                                        
                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Unidade 2 -->
                            <div class="card-body swiper-slide">

                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->
                                        <div class="unit-desc">
                                            <h3 class="name">Unidade 2</h3>
                                            <p class="adress">Av. das Américas, 5000 - Barra da Tijuca, Rio de Janeiro -
                                                RJ, 22640-102</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">4.0</span>
                                            <span class="star-rating" data-rating-value="4.0"></span>
                                            <span class="review-number">(999 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->
                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart2"></canvas>
                                        </div>
                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Unidade 3 -->
                            <div class="card-body swiper-slide">
                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->
                                        <div class="unit-desc">
                                            <h3 class="name">Unidade 3</h3>
                                            <p class="adress">Av. Afonso Pena, 1000 - Centro, Belo Horizonte - MG,
                                                30130-003</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">4.9</span>
                                            <span class="star-rating" data-rating-value="4.9"></span>
                                            <span class="review-number">(1920 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->
                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart3"></canvas>
                                        </div>
                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="table-card" id="unidades">
                    <div class="card-header">
                        <div class="card-title">
                            <h2>Unidades</h2>
                        </div>
                        <div class="search-field">
                            <input type="text" id="customSearch" class="pesquisar" placeholder="Pesquisar unidade">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                    </div>

                    <div class="card-body">
                        <table id="myTable" class="display">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Unidade</th>
                                    <th>Endereço</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" data-href="./unidadeMatriz.html">
                                    <td>1</td>
                                    <td>Unidade Matriz</td>
                                    <td>Rua A, 123, São Paulo</td>
                                </tr>
                                <tr class="clickable-row" data-href="./unidade2.html">
                                    <td>2</td>
                                    <td>Unidade 2</td>
                                    <td>Rua B, 456, Rio de Janeiro</td>
                                </tr>
                                <tr class="clickable-row" data-href="./unidade3.html">
                                    <td>3</td>
                                    <td>Unidade 3</td>
                                    <td>Rua C, 789, Belo Horizonte</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- fim do corpo da dash -->

        </div>
        <!-- fim conteudo da dash -->

    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/graficoBodyDash.js"></script>
    <!-- JS do Swiper Slides -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
</body>

</html>

<script>

    // Sidebar Dinâmico - Essa função arruma o sidebar para abrir e fechar
    const barBtn = document.getElementById("toggle-dash-btn");
    const sidebar = document.querySelector(".sidebar");
    const dashContent = document.querySelector(".dash-content");
    const configSubMenu = document.querySelectorAll(".submenu");
    const SubMenuLi = document.querySelector(".submenu-list");

    const toggleSidebar = () => {

        if (SubMenuLi.classList.contains("active")) {
            SubMenuLi.classList.remove("active");
        };

        sidebar.classList.toggle("active");
        dashContent.classList.toggle("active");
    }


    barBtn.addEventListener("click", () => {
        toggleSidebar();
    })

    configSubMenu.forEach((el) => {
        el.addEventListener("click", () => {
            openSubMenu();
        });
    });

    const openSubMenu = () => {
        if (sidebar.classList.contains("active")) {
            sidebar.classList.toggle("active")
            dashContent.classList.toggle("active");
        }
        SubMenuLi.classList.toggle("active");
    }

    // Tabela unidades
    $(document).ready(function () {
        var table = $('#myTable').DataTable({
            paging: false, // Habilita a paginação
            searching: true, // Desabilita a pesquisa padrão
            ordering: true, // Habilita a ordenação
            lengthChange: false, // Esconde seletor de entradas
            info: false // Esconde detalhe de entradas
        });

        // Conexão do campo de pesquisa personalizado com a tabela
        $('#customSearch').on('keyup change', function () {
            table.search(this.value).draw(); // Filtra a tabela com o valor do campo
        });

        // Redireciona ao clicar na linha
        $('.clickable-row').click(function () {
            window.location = $(this).data('href');
        });
    });

    // Active Dinâmico - Essa função passa o active para as seções unidades e visão geral de acordo com scroll da página
    document.addEventListener('DOMContentLoaded', function () {
        const visaoGeral = document.getElementById('visaoGeral');
        const unidades = document.getElementById('unidades');
        const navItems = document.querySelectorAll('.nav-item');

        const sections = [visaoGeral, unidades];

        function onScroll() {
            let currentSectionId = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionBottom = sectionTop + sectionHeight;
                const scrollPosition = window.scrollY + window.innerHeight / 2; // Posição de scroll ajustada

                // Verifica se o meio da janela está dentro dos limites da seção
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                    currentSectionId = section.getAttribute('id');
                }
            });

            if (currentSectionId) {
                navItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-target') === currentSectionId) {
                        item.classList.add('active');
                    }
                });
            }
        }

        window.addEventListener('scroll', onScroll);
        onScroll(); // Inicializa o estado ativo ao carregar a página
    });


    // Essa função apenas ajusta o ponto de acoragem dentro da página por causa do header que ocupa 100px de altura
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();

            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            const headerOffset = 100; // Altura do header

            if (targetElement) {
                const elementPosition = targetElement.offsetTop;
                const offsetPosition = elementPosition - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });


    // Seleciona todos os elementos que contêm as estrelas
    const divEstrelasList = document.querySelectorAll('.star-rating');

    // Itera sobre cada elemento
    divEstrelasList.forEach(divEstrelas => {
        // Converte o valor de avaliação para um número
        const valorEstrela = Number(divEstrelas.getAttribute('data-rating-value'));

        // Separa a parte inteira e decimal do valor de avaliação
        const valorEstrelaInteiro = Math.trunc(valorEstrela);
        const valorEstrelaDecimal = valorEstrela - valorEstrelaInteiro;


        // Adiciona estrelas inteiras
        for (let i = 0; i < valorEstrelaInteiro; i++) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star', 'fill-star');
            divEstrelas.appendChild(starIcon);
        }

        // Adiciona meia estrela se necessário
        if (valorEstrelaDecimal >= 0.5) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star-half', 'fill-star');
            divEstrelas.appendChild(starIcon);
        }

        // Conta a quantidade de estrelas já adicionadas
        let qntdEstrelaPreenchida = divEstrelas.querySelectorAll('.fill-star').length;

        // Adiciona estrelas vazias para completar 5 estrelas
        for (let i = qntdEstrelaPreenchida; i < 5; i++) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star', 'null-star'); // Estrela vazia
            divEstrelas.appendChild(starIcon);
        }
    });
    const swiper = new Swiper('.swiper', {
        pagination: {
            el: '.swiper-pagination',
            type: 'progressbar',
        }

    });

</script>