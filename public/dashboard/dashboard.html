<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="shortcut icon" href="../assets/iconPage.png" type="image/x-icon">
    <!-- Icons Font Awesome -->
    <script src="https://kit.fontawesome.com/64ceb195cd.js" crossorigin="anonymous"></script>
    <!-- Icones Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- CSS do DataTables -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- CSS do Swipper Slides -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- JS do DataTables -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <!-- CSS Local -->
    <link rel="stylesheet" href="../css/dashboard.css">
</head>

<body>


    <div class="dash-box">

        <!-- sidebar -->
        <div class="sidebar">

            <!-- header sidebar -->
            <div class="header-sidebar">

                <!-- logo -->
                <div class="nav-logo">
                    <img src="../assets/logoBranca.svg" alt="">
                    <h2>Smart Think</h2>
                </div>

                <!-- botão que muda sidebar -->
                <div id="toggle-dash-btn">
                    <i class="fa-solid fa-bars"></i>
                </div>
            </div>
            <!-- fim header sidebar -->

            <!-- menu sidebar -->
            <nav class="menu">
                <div class="menu-label">
                    <h2>Menu</h2>
                </div>
                <ul class="nav-menu">

                    <!-- visão geral -->
                    <li class="nav-item active" data-target="visaoGeral">
                        <a href="dashboard.html">
                            <i class='bx bxs-grid-alt'></i>
                            <p>Visão Geral</p>
                        </a>
                    </li>

                    <!-- unidades -->
                    <li class="nav-item submenu" data-target="unidades">
                        <i class='bx bxs-store'></i>
                        <p>Unidades</p>
                        <span>▾</span>
                    </li>
                    <ul class="submenu-list">
                        <li class="submenu-item">
                            <a href="unidadeMatriz.html">
                                <p>Matriz</p>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="unidade2.html">
                                <p>Unidade 2</p>
                            </a>
                        </li>
                        <li class="submenu-item">
                            <a href="unidade3.html">
                                <p>Unidade 3</p>
                            </a>
                        </li>
                    </ul>

                    <!-- insights  -->
                    <li class="nav-item">
                        <a href="campanha.html">
                            <!-- <i class='bx bxs-calendar-event'></i> -->
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28">
                                <path d="M14 28C14 26.0633 13.6267 24.2433 12.88 22.54C12.1567 20.8367 11.165 19.355 9.905 18.095C8.645 16.835 7.16333 15.8433 5.46 15.12C3.75667 14.3733 1.93667 14 0 14C1.93667 14 3.75667 13.6383 5.46 12.915C7.16333 12.1683 8.645 11.165 9.905 9.905C11.165 8.645 12.1567 7.16333 12.88 5.46C13.6267 3.75667 14 1.93667 14 0C14 1.93667 14.3617 3.75667 15.085 5.46C15.8317 7.16333 16.835 8.645 18.095 9.905C19.355 11.165 20.8367 12.1683 22.54 12.915C24.2433 13.6383 26.0633 14 28 14C26.0633 14 24.2433 14.3733 22.54 15.12C20.8367 15.8433 19.355 16.835 18.095 18.095C16.835 19.355 15.8317 20.8367 15.085 22.54C14.3617 24.2433 14 26.0633 14 28Z" fill="currentColor"/>
                            </svg>                            
                            <p>Insights</p>
                        </a>
                    </li>

                    <!-- notificações -->
                    <li class="nav-item">
                        <a href="">
                            <i class='bx bxs-inbox'></i>
                            <p>Atividades</p>
                        </a>
                    </li>

                    <!-- configurações -->
                    <li class="nav-item submenu">
                        <i class='bx bxs-cog'></i>
                        <p>Configurações</p>
                        <span>▾</span>
                    </li>
                    <ul class="submenu-list">
                        <li class="submenu-item nav-item">
                            <a href="../dashboard/user.html">
                                <p>Meu perfil</p>
                            </a>
                        </li>
                        <li class="submenu-item nav-item">
                            <a href="../dashboard/brand.html">
                                <p>Minha marca</p>
                            </a>
                        </li>
                    </ul>

                </ul>
            </nav>
            <!-- fim menu sidebar -->

            <!-- footer sidebar -->
            <div class="footer-sidebar">
                <div class="menu-user">
                    <div class="user-icon"><i class="fa-solid fa-user"></i></div>
                    <div class="user-account">
                        <div class="userName"><span>Fernando Henrique</span></div>
                        <div class="userEmail"><span>fernando.321.www@gmail.com</span></div>
                    </div>
                    <div id="exitBtn"><i class="fa-solid fa-right-from-bracket"></i></div>
                </div>
            </div>
            <!-- fim footer sidebar -->
        </div>
        <!-- fim sidebar -->

        <!-- conteudo da dash -->
        <div class="dash-content">

            <!-- header da dash -->
            <div class="dash-header">

                <div class="title"><span>Visão Geral</span></div>
                <div id="modal-notify">
                    <i class='bx bxs-inbox'></i>
                </div>
            </div>
            <!-- fim header da dash -->

            <!-- corpo da dash -->
            <div class="dash-body" id="visaoGeral">
                <div class="kpi-wrapper">

                    <!-- kpi 1 -->
                    <div class="kpi-card primary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Unidades Ativas</h2>
                            </div>

                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Total de 3 unidades</p>
                                </div>
                            </div>

                        </div>
                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>3</span>
                            </div>
                        </div>
                    </div>

                    <!-- kpi 2 -->
                    <div class="kpi-card secondary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Satisfação Média Mensal</h2>
                            </div>
                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Total de 4 unidades</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>20%</span>
                            </div>
                        </div>
                    </div>

                    <!-- kpi 3 -->
                    <div class="kpi-card secondary">
                        <div class="kpi-header">
                            <div class="kpi-title">
                                <h2>Média de reclamações por filial</h2>
                            </div>

                            <div class="tooltip">
                                <i class="fa-solid fa-circle-info"></i>
                                <div class="tooltip-box">
                                    <p>Esse valor representa uma estimativa mensal a partir da análise de sentimento dos
                                        clientes.</p>
                                </div>
                            </div>
                        </div>

                        <div class="kpi-body">
                            <div class="kpi-value">
                                <span>45</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-wrapper">
                    <!-- card 1 -->
                    <div class="chart-card">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Distribuição de reclamações no ano</h2>
                            </div>

                            <div class="tooltip">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <div class="tooltip-box">
                                    <p>Unidade 3: 72,6%</p>
                                </div>
                            </div>

                        </div>
                        <div class="card-body">
                            <div class="chart-box">
                                <canvas id="myChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- card 2 -->
                    <div class="chart-card swiper">
                        <div class="card-header">
                            <div class="card-title">
                                <h2>Comparativo de unidades</h2>
                            </div>
                            <select id="slideSelector" class="selectSlide">
                                <option value="0">Matriz</option>
                                <option value="1">Unidade 2</option>
                                <option value="2">Unidade 3</option>
                                
                            </select>
                            <!-- Pagination -->
                            <div class="swiper-pagination"></div>
                        </div>


                        <!-- Unidade 1 -->
                        <div class="swiper-wrapper">
                            <div class="card-body swiper-slide">
                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->

                                        <div class="unit-desc">
                                            <h3 class="name">Unidade Matriz</h3>
                                            <p class="adress">Av. Sapopemba, 20020 - Vila Ester, São Paulo - SP,
                                                08330-245</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">3.5</span>
                                            <span class="star-rating" data-rating-value="3.5"></span>
                                            <span class="review-number">(679 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->

                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart1"></canvas>
                                        </div>

                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>

                                        <a href="unidadeMatriz.html" class="linkBtn">acessar</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Unidade 2 -->
                            <div class="card-body swiper-slide">

                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->
                                        <div class="unit-desc">
                                            <h3 class="name">Unidade 2</h3>
                                            <p class="adress">Av. das Américas, 5000 - Barra da Tijuca, Rio de Janeiro -
                                                RJ, 22640-102</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">3.9</span>
                                            <span class="star-rating" data-rating-value="3.9"></span>
                                            <span class="review-number">(999 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->
                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart2"></canvas>
                                        </div>
                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>
                                        <a href="unidade2.html" class="linkBtn">acessar</a>
                                    </div>
                                </div>
                            </div>

                            <!-- Unidade 3 -->
                            <div class="card-body swiper-slide">
                                <div class="chart-box flex-display swiper-slide">
                                    <!-- wrap 1 -->
                                    <div class="wrap-area">
                                        <!-- descricao da unidade -->
                                        <div class="unit-desc">
                                            <h3 class="name">Unidade 3</h3>
                                            <p class="adress">Av. Afonso Pena, 1000 - Centro, Belo Horizonte - MG,
                                                30130-003</p>
                                        </div>
                                        <!-- status da unidade -->
                                        <div class="unit-stats">
                                            <span class="review-rating">2.2</span>
                                            <span class="star-rating" data-rating-value="2.2"></span>
                                            <span class="review-number">(1920 avaliações)</span>
                                        </div>
                                        <!-- grafico de avaliações -->
                                        <div class="chart-mini-box">
                                            <canvas id="myBarChart3"></canvas>
                                        </div>
                                    </div>
                                    <!-- wrap 2 -->
                                    <div class="wrap-area">
                                        <div class="review positive-review">
                                            <h2>Análise Positiva</h2>
                                            <span><i class="fa-solid fa-check"></i>Comida boa</span>
                                            <span><i class="fa-solid fa-check"></i>Local Limpo</span>
                                            <span><i class="fa-solid fa-check"></i>Atendentes</span>
                                        </div>
                                        <div class="review negative-review">
                                            <h2>Análise Negativa</h2>
                                            <span><i class="fa-solid fa-xmark"></i>Atendimento devagar</span>
                                            <span><i class="fa-solid fa-xmark"></i>Falta de troco</span>
                                            <span><i class="fa-solid fa-xmark"></i>Filas</span>
                                        </div>
                                        <a href="unidade3.html" class="linkBtn">acessar</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- <div class="table-card" id="unidades">
                    <div class="card-header">
                        <div class="card-title">
                            <h2>Unidades</h2>
                        </div>
                        <div class="search-field">
                            <input type="text" id="customSearch" class="pesquisar" placeholder="Pesquisar unidade">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                    </div>

                    <div class="card-body">
                        <table id="myTable" class="display">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Unidade</th>
                                    <th>Endereço</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="clickable-row" data-href="./unidadeMatriz.html">
                                    <td>1</td>
                                    <td>Unidade Matriz</td>
                                    <td>Rua A, 123, São Paulo</td>
                                </tr>
                                <tr class="clickable-row" data-href="./unidade2.html">
                                    <td>2</td>
                                    <td>Unidade 2</td>
                                    <td>Rua B, 456, Rio de Janeiro</td>
                                </tr>
                                <tr class="clickable-row" data-href="./unidade3.html">
                                    <td>3</td>
                                    <td>Unidade 3</td>
                                    <td>Rua C, 789, Belo Horizonte</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> -->
                <!-- fim do corpo da dash -->

            </div>
            <!-- fim conteudo da dash -->

        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

        <script src="../js/graficoBodyDash.js"></script>
        <!-- JS do Swiper Slides -->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
</body>

</html>

<script>

    // Sidebar Dinâmico - Essa função arruma o sidebar para abrir e fechar
    const barBtn = document.getElementById("toggle-dash-btn");
    const sidebar = document.querySelector(".sidebar");
    const dashContent = document.querySelector(".dash-content");
    const subMenuBtns = document.querySelectorAll(".submenu");


    const toggleSidebar = () => {
        sidebar.classList.toggle("active");
        dashContent.classList.toggle("active");

        // Fecha todos os submenus ao alternar o sidebar
        subMenuBtns.forEach(btn => {
            const subMenuList = btn.nextElementSibling;
            if (subMenuList) {
                subMenuList.classList.remove("active");
            }
        });
    }

    barBtn.addEventListener("click", () => {
        toggleSidebar();
    });


    subMenuBtns.forEach((btn) => {
        btn.addEventListener("click", (event) => {
            event.preventDefault(); // Impede o comportamento padrão do link <a>

            // Encontra a lista submenu correspondente
            const subMenuList = btn.nextElementSibling;

            if (subMenuList) { // Verifica se o submenu existe
                // Fecha outros submenus abertos
                subMenuBtns.forEach(otherBtn => {
                    if (otherBtn !== btn) {
                        const otherSubMenuList = otherBtn.nextElementSibling;
                        if (otherSubMenuList) {
                            otherSubMenuList.classList.remove("active");
                        }
                    }
                });

                // Alterna a visibilidade do submenu clicado
                subMenuList.classList.toggle("active");

                // Ajusta o sidebar se estiver aberto e o submenu for ativado
                if (sidebar.classList.contains("active") && subMenuList.classList.contains("active")) {
                    sidebar.classList.remove("active");
                    dashContent.classList.remove("active");
                }
            }
        });
    });

    // Inicializando Carrosel   
    const swiper = new Swiper('.swiper', {
        pagination: {
            el: '.swiper-pagination',
            type: 'progressbar',
        }

    });

    // Obtenha o campo select
    const slideSelector = document.getElementById('slideSelector');

    // Adicione um ouvinte de eventos para mudar o slide quando o valor do select mudar
    slideSelector.addEventListener('change', function () {
        const selectedSlideIndex = parseInt(this.value, 10);
        swiper.slideTo(selectedSlideIndex);
    });

    // Adicione um ouvinte de eventos ao carrossel para detectar mudanças de slide
    swiper.on('slideChange', function () {
        const currentSlideIndex = swiper.activeIndex;
        slideSelector.value = currentSlideIndex;
    });



    // Tabela unidades
    $(document).ready(function () {
        var table = $('#myTable').DataTable({
            paging: false, // Habilita a paginação
            searching: true, // Desabilita a pesquisa padrão
            ordering: true, // Habilita a ordenação
            lengthChange: false, // Esconde seletor de entradas
            info: false // Esconde detalhe de entradas
        });

        // Conexão do campo de pesquisa personalizado com a tabela
        $('#customSearch').on('keyup change', function () {
            table.search(this.value).draw(); // Filtra a tabela com o valor do campo
        });

        // Redireciona ao clicar na linha
        $('.clickable-row').click(function () {
            window.location = $(this).data('href');
        });
    });

    // Active Dinâmico - Essa função passa o active para as seções unidades e visão geral de acordo com scroll da página
    document.addEventListener('DOMContentLoaded', function () {
        const visaoGeral = document.getElementById('visaoGeral');
        const unidades = document.getElementById('unidades');
        const navItems = document.querySelectorAll('.nav-item');

        const sections = [visaoGeral, unidades];

        function onScroll() {
            let currentSectionId = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.offsetHeight;
                const sectionBottom = sectionTop + sectionHeight;
                const scrollPosition = window.scrollY + window.innerHeight / 2; // Posição de scroll ajustada

                // Verifica se o meio da janela está dentro dos limites da seção
                if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                    currentSectionId = section.getAttribute('id');
                }
            });

            if (currentSectionId) {
                navItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-target') === currentSectionId) {
                        item.classList.add('active');
                    }
                });
            }
        }

        window.addEventListener('scroll', onScroll);
        onScroll(); // Inicializa o estado ativo ao carregar a página
    });


    // Essa função apenas ajusta o ponto de acoragem dentro da página por causa do header que ocupa 100px de altura
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();

            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            const headerOffset = 100; // Altura do header

            if (targetElement) {
                const elementPosition = targetElement.offsetTop;
                const offsetPosition = elementPosition - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });


    // Seleciona todos os elementos que contêm as estrelas
    const divEstrelasList = document.querySelectorAll('.star-rating');

    // Itera sobre cada elemento
    divEstrelasList.forEach(divEstrelas => {
        // Converte o valor de avaliação para um número
        const valorEstrela = Number(divEstrelas.getAttribute('data-rating-value'));

        // Separa a parte inteira e decimal do valor de avaliação
        const valorEstrelaInteiro = Math.trunc(valorEstrela);
        const valorEstrelaDecimal = valorEstrela - valorEstrelaInteiro;


        // Adiciona estrelas inteiras
        for (let i = 0; i < valorEstrelaInteiro; i++) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star', 'fill-star');
            divEstrelas.appendChild(starIcon);
        }

        // Adiciona meia estrela se necessário
        if (valorEstrelaDecimal >= 0.5) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star-half', 'fill-star');
            divEstrelas.appendChild(starIcon);
        }

        // Conta a quantidade de estrelas já adicionadas
        let qntdEstrelaPreenchida = divEstrelas.querySelectorAll('.fill-star').length;

        // Adiciona estrelas vazias para completar 5 estrelas
        for (let i = qntdEstrelaPreenchida; i < 5; i++) {
            const starIcon = document.createElement('i');
            starIcon.classList.add('fa-solid', 'fa-star', 'null-star'); // Estrela vazia
            divEstrelas.appendChild(starIcon);
        }
    });


</script>